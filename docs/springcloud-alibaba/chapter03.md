---
title: "分布式远程服务调用"
category:
  - "springcloud-alibaba"
tag:
  - "分布式系统"
  - "远程服务调用"
---

## 背景知识

在单体应用，不同功能模块之间的调用过程多是通过调用方法来实现的，而拆分成微服务架构后，由于物理部署方式的改变（主要表现形式是：单个部署包变成多个部署包），不同模块之间的调用方式也发生了本质上的改变。

微服务架构中，服务之间的调用大多是通过RPC调用完成的，RPC就是远程服务调用。通俗点讲就是被调用者通过暴露接口，调用者调用被调用者暴露出来的接口来实现调用过程。

简单说一下RPC和SOA的区别，SOA的主要特点是构建一种消息组件，让所有的服务统一通过这个消息组件实现相互调用，它主要的特点是有一个统一的消息组件，另外一个特点是所有的服务提供的接口都是经过统一格式定义过的，Dubbo和WebService都属于SOA的范畴。而RPC则是取消了统一的消息组件，服务与服务之间的调用是通过直接的网络调用，调用过程优雅，像本地调用一样简单便捷，SpringCloud技术栈属于这个范畴。

在微服务的发展的早期，远程服务调用多是通过JDK原生的URLConnection来实现的，后期出现了HttpClient、OkHttp的组件。目前微服务架构中，多是使用RestTemplat和OpenFeign来完成远程服务调用的。

## 技术选型

OpenFeign是SpringCloud官方提供的远程服务调用的组件，我们“别无选择”，就它了。

## 功能实践

要想使用OpenFeign，我们就要先明白它的大概原理： 服务提供者与服务消费者都注册到服务治理中心上，服务调用者在调用过程中，先从服务治理中心获取服务提供者的地址，然后再组装实际的调用地址，之后完成服务的调用。因此我们还需要一个服务治理中心，这里我们还是使用Nacos。

关于RestTemplate方式调用和OpenFeign方式的简单调用，可以参考[服务治理之Nacos](chapter01.md)章节进行查阅。

## OpenFeign高级特性

### 多参数



### URL中携带参数

### 传递对象

### 文件上传

### 文件下载

### 开启GZIP压缩

### 开启日志

### 超时控制

### 替换默认的客户端



- 不同使用方式
  - 多参数
  - URL中携带参数
  - 传递对象
  - 文件上传
  - 文件下载
- 开启GZIP压缩
- 开启日志
- 超时控制
  - 在服务提供者提供的接口中休眠3s，服务消费者接口就会报连接超时的情况；
  - 在配置文件中设置默认的超时时间
- 替换客户端
  - 替换成httpclient
    - 超时时间的默认配置不能丢
  - 替换成okhttp
    - 超时时间的默认配置不能丢



## 总结


<img style="border:1px red solid; display:block; margin:0 auto;" :src="$withBase('/qrcode.jpg')" alt="微信公众号" />